{
  "version": 3,
  "sources": ["../../src/routes/main.route.ts"],
  "sourcesContent": ["import { FastifyInstance } from 'fastify'\nimport { IRestOptions } from '../mrq.interfaces'\nimport { getMainHandler } from '../handler/main.handler'\nimport { roleHook } from '../hooks/role.hook'\nimport { subRoute } from './sub.route'\nimport { getSubarray } from '../utils/mongoose.utils'\n\nexport const mainRoute =\n  (opts: IRestOptions) => async (app: FastifyInstance) => {\n    app.addHook('onRequest', roleHook(opts))\n\n    for (const [\n      modelName,\n      { endpointName, schema, handlerAccesses },\n    ] of Object.entries(opts.schemas)) {\n      const mainHandler = getMainHandler(modelName, handlerAccesses)\n\n      let prefix = `/${endpointName}`\n\n      app.get(prefix, mainHandler.getByQuery)\n\n      app.get(`${prefix}/count`, mainHandler.count)\n\n      app.get(`${prefix}/distinct/:path`, mainHandler.distinct)\n\n      app.post(prefix, mainHandler.create)\n\n      app.put(prefix, mainHandler.updateMany)\n\n      app.put(`${prefix}/overwrite`, mainHandler.updateMany)\n\n      app.delete(prefix, mainHandler.deleteByQuery)\n\n      prefix += `/:id`\n\n      app.get(prefix, mainHandler.getById)\n\n      app.put(prefix, mainHandler.updateById)\n\n      app.put(`${prefix}/overwrite`, mainHandler.updateById)\n\n      app.delete(prefix, mainHandler.deleteById)\n\n      app.register(\n        subRoute(modelName, {\n          schema,\n          handlerAccesses,\n          getSubarray,\n          subPathName: '',\n          subIdName: 'subId',\n        }),\n        { prefix }\n      )\n    }\n  }\n"],
  "mappings": ";AAEA,SAAS,sBAAsB;AAC/B,SAAS,gBAAgB;AACzB,SAAS,gBAAgB;AACzB,SAAS,mBAAmB;AAErB,IAAM,YACX,CAAC,SAAuB,OAAO,QAAyB;AACtD,MAAI,QAAQ,aAAa,SAAS,IAAI,CAAC;AAEvC,aAAW;AAAA,IACT;AAAA,IACA,EAAE,cAAc,QAAQ,gBAAgB;AAAA,EAC1C,KAAK,OAAO,QAAQ,KAAK,OAAO,GAAG;AACjC,UAAM,cAAc,eAAe,WAAW,eAAe;AAE7D,QAAI,SAAS,IAAI,YAAY;AAE7B,QAAI,IAAI,QAAQ,YAAY,UAAU;AAEtC,QAAI,IAAI,GAAG,MAAM,UAAU,YAAY,KAAK;AAE5C,QAAI,IAAI,GAAG,MAAM,mBAAmB,YAAY,QAAQ;AAExD,QAAI,KAAK,QAAQ,YAAY,MAAM;AAEnC,QAAI,IAAI,QAAQ,YAAY,UAAU;AAEtC,QAAI,IAAI,GAAG,MAAM,cAAc,YAAY,UAAU;AAErD,QAAI,OAAO,QAAQ,YAAY,aAAa;AAE5C,cAAU;AAEV,QAAI,IAAI,QAAQ,YAAY,OAAO;AAEnC,QAAI,IAAI,QAAQ,YAAY,UAAU;AAEtC,QAAI,IAAI,GAAG,MAAM,cAAc,YAAY,UAAU;AAErD,QAAI,OAAO,QAAQ,YAAY,UAAU;AAEzC,QAAI;AAAA,MACF,SAAS,WAAW;AAAA,QAClB;AAAA,QACA;AAAA,QACA;AAAA,QACA,aAAa;AAAA,QACb,WAAW;AAAA,MACb,CAAC;AAAA,MACD,EAAE,OAAO;AAAA,IACX;AAAA,EACF;AACF;",
  "names": []
}
